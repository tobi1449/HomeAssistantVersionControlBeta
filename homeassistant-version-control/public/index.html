<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Home Assistant Version Control</title>
  <script src="js/diff.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
  <link rel="stylesheet" href="css/style.css?v=1734109500">
  <link rel="icon" type="image/x-icon" href="images/favicon.ico">
</head>

<body class="dark-mode">
  <!-- Snow Container for Holiday Mode -->
  <div id="snowContainer" class="snow-container"></div>
  <div class="container">
    <div class="header">
      <div style="display: flex; align-items: center; gap: clamp(10px, 1.5vw, 14px);">
        <img src="images/icon.png" alt="Logo"
          style="width: clamp(36px, 5vw, 48px); height: clamp(36px, 5vw, 48px); border-radius: 6px;">
        <div style="margin-top: -4px;">
          <div class="title" data-i18n="app.title">Home Assistant Version Control</div>
          <div style="color: var(--text-tertiary); font-size: 14px; margin-top: -12px;" data-i18n="app.subtitle">Browse
            and restore backups like magic.</div>
        </div>
      </div>
      <button class="btn-subtle" onclick="openSettings()" data-i18n="app.settings">Settings</button>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchMode('timeline')" id="timelineTab"
        data-i18n="tabs.history">History</button>
      <button class="tab" onclick="switchMode('files')" id="filesTab" data-i18n="tabs.files">Files</button>
      <button class="tab" onclick="switchMode('automations')" id="automationsTab"
        data-i18n="tabs.automations">Automations</button>
      <button class="tab" onclick="switchMode('scripts')" id="scriptsTab" data-i18n="tabs.scripts">Scripts</button>
    </div>

    <div class="content">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-header-top">
            <div class="panel-header-info">
              <h2 id="leftPanelTitle" data-i18n="timeline.title">Timeline</h2>
            </div>
            <div class="panel-header-actions" id="leftPanelActions" style="display: none;">
              <select id="sortSelect" class="sort-select" onchange="handleSortChange(this.value)">
                <option value="default" data-i18n="sort.default">Default</option>
                <option value="name_asc" data-i18n="sort.name_asc">Name (A-Z)</option>
                <option value="name_desc" data-i18n="sort.name_desc">Name (Z-A)</option>
                <option value="recently_modified" data-i18n="sort.recently_modified">Recently Modified</option>
                <option value="deleted" data-i18n="sort.deleted">Deleted</option>
              </select>
            </div>
          </div>
        </div>
        <div class="panel-content">
          <div class="search-container" id="timelineSearch">
            <input type="text" class="search-input" placeholder="Search versions by message..."
              oninput="handleSearch(event)" id="searchInput" data-i18n="timeline.search_placeholder">
            <button class="search-clear" onclick="clearSearch()" id="clearBtn" style="display: none;">×</button>
            <div class="search-info" id="searchInfo"></div>
          </div>
          <div id="leftPanel" class="custom-scrollbar">
            <div class="empty" data-i18n="app.loading">Loading...</div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <div class="panel-header-top">
            <div class="panel-header-info">
              <h2 id="rightPanelTitle" data-i18n="timeline.files_in_commit">Files in Commit</h2>
              <p id="itemsSubtitle"></p>
            </div>
            <div class="panel-header-actions" id="rightPanelActions">
              <!-- Restore button will appear here when needed -->
            </div>
          </div>
        </div>
        <div id="rightPanel" class="panel-content custom-scrollbar">
          <div class="empty" data-i18n="timeline.select_commit">Select a commit to see files</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" id="diffModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle" data-i18n="diff.title">File Diff</div>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-content">
        <div class="commit-info" id="commitInfo" data-i18n="app.loading">
          Loading...
        </div>
        <div class="diff-container">
          <div class="diff-panel">
            <div class="diff-header" data-i18n="diff.current_version">Current Version</div>
            <div class="diff-content custom-scrollbar" id="currentContent"></div>
          </div>
          <div class="diff-panel">
            <div class="diff-header" data-i18n="diff.backup_version">Backup Version</div>
            <div class="diff-content custom-scrollbar" id="backupContent"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal()" data-i18n="app.cancel">Cancel</button>
        <button class="btn restore" id="restoreBtn" onclick="confirmRestore()"
          data-i18n="diff.restore_this_file">Restore This File</button>
      </div>
    </div>
  </div>

  <!-- Restore Preview Modal -->
  <div class="modal-overlay" id="restorePreviewModal">
    <div class="modal" style="max-width: 900px;">
      <div class="modal-header">
        <div class="modal-title" id="restorePreviewTitle" data-i18n="restore_preview.title">Preview Restore</div>
        <button class="modal-close" onclick="closeRestorePreview()">&times;</button>
      </div>
      <div class="modal-content">
        <div class="commit-info" id="restorePreviewInfo" data-i18n="restore_preview.loading_preview">
          Loading preview...
        </div>
        <div class="diff-content custom-scrollbar" id="restoreDiffContent"
          style="max-height: 60vh; overflow-y: auto; background: #1a1a1a; border-radius: 6px; padding: 16px; margin-top: 16px;">
          <div class="empty" data-i18n="diff.loading_diff">Loading diff...</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeRestorePreview()" data-i18n="app.cancel">Cancel</button>
        <button class="btn restore" id="confirmRestoreBtn" onclick="doRestore()"
          data-i18n="restore_preview.confirm_restore">Confirm Restore</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal settings-modal" style="max-width: 430px;">
      <div class="modal-header">
        <div class="modal-title" data-i18n="app.settings">Settings</div>
        <button class="modal-close" onclick="closeSettings()">&times;</button>
      </div>
      <div class="modal-content">
        <div class="settings-section">

          <!-- Group 2: General -->
          <div class="settings-group">
            <div class="settings-group-title" data-i18n="settings.group_general">General</div>

            <div id="debounceTimeOptions" style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 8px;">
                <span style="color: var(--text-primary); font-size: 14px;" data-i18n="settings.debounce_time">Debounce
                  Time</span>
              </label>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                <div class="custom-number-input-wrapper" style="position: relative;">
                  <input type="number" id="debounceTime" min="0" value="3" style="
                    width: 100%;
                    padding: 10px 32px 10px 12px;
                    background: var(--bg-tertiary);
                    border: 1px solid var(--border-subtle);
                    border-radius: var(--radius-md);
                    color: var(--text-primary);
                    font-size: 14px;
                    -moz-appearance: textfield;
                    appearance: textfield;
                  ">
                  <div class="custom-spinners"
                    style="position: absolute; right: 2px; top: 2px; bottom: 2px; display: flex; flex-direction: column; width: 24px;">
                    <button class="spinner-btn spinner-up" onclick="stepInput('debounceTime', 1)"
                      style="flex: 1; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0;">
                      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                        stroke="#9ca3af" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                        style="transform: rotate(180deg);">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                    <button class="spinner-btn spinner-down" onclick="stepInput('debounceTime', -1)"
                      style="flex: 1; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0;">
                      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                        stroke="#9ca3af" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                      </svg>
                    </button>
                  </div>
                </div>
                <select id="debounceTimeUnit" style="
                  width: 100%;
                  padding: 10px 12px;
                  background: var(--bg-tertiary);
                  border: 1px solid var(--border-subtle);
                  border-radius: var(--radius-md);
                  color: var(--text-primary);
                  font-size: 14px;
                  -webkit-appearance: none;
                  appearance: none;
                ">
                  <option value="seconds" data-i18n="units.seconds">Seconds</option>
                  <option value="minutes" data-i18n="units.minutes">Minutes</option>
                  <option value="hours" data-i18n="units.hours">Hours</option>
                  <option value="days" data-i18n="units.days">Days</option>
                </select>
              </div>
              <p style="color: var(--text-secondary); font-size: 12px; margin-top: 6px; margin-left: 2px;"
                data-i18n="settings.debounce_time_desc">
                Time to wait before creating a version after file changes
              </p>
            </div>

            <div class="setting-item" style="margin-bottom: 20px;">
              <label style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;">
                <span style="color: var(--text-primary); font-size: 14px;"
                  data-i18n="settings.history_retention">History
                  Retention</span>
                <div class="toggle-switch">
                  <input type="checkbox" id="historyRetention" style="display: none;">
                  <label for="historyRetention" class="toggle-slider" onclick="handleRetentionToggle()"></label>
                </div>
              </label>
              <div id="retentionOptions" style="margin-top: 12px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                  <div class="custom-number-input-wrapper" style="position: relative;">
                    <input type="number" id="retentionValue" min="1" value="30" style="
                    width: 100%;
                    padding: 10px 32px 10px 12px;
                    background: var(--bg-tertiary);
                    border: 1px solid var(--border-subtle);
                    border-radius: var(--radius-md);
                    color: var(--text-primary);
                    font-size: 14px;
                    -moz-appearance: textfield;
                    appearance: textfield;
                  ">
                    <div class="custom-spinners"
                      style="position: absolute; right: 2px; top: 2px; bottom: 2px; display: flex; flex-direction: column; width: 24px;">
                      <button class="spinner-btn spinner-up" onclick="stepInput('retentionValue', 1)"
                        style="flex: 1; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                          stroke="#9ca3af" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                          style="transform: rotate(180deg);">
                          <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                      </button>
                      <button class="spinner-btn spinner-down" onclick="stepInput('retentionValue', -1)"
                        style="flex: 1; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                          stroke="#9ca3af" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                          <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                      </button>
                    </div>
                  </div>
                  <select id="retentionUnit" style="
                    width: 100%;
                    padding: 10px 12px;
                    background: var(--bg-tertiary);
                    border: 1px solid var(--border-subtle);
                    border-radius: var(--radius-md);
                    color: var(--text-primary);
                    font-size: 14px;
                    -webkit-appearance: none;
                    appearance: none;
                  ">
                    <option value="hours" data-i18n="units.hours">Hours</option>
                    <option value="days" selected data-i18n="units.days">Days</option>
                    <option value="weeks" data-i18n="units.weeks">Weeks</option>
                    <option value="months" data-i18n="units.months">Months</option>
                  </select>
                </div>
              </div>
              <p style="color: var(--text-secondary); font-size: 12px; margin-top: 6px; margin-left: 2px;"
                data-i18n="settings.history_retention_desc">
                Merge versions older than the specified time period
              </p>
            </div>

          </div>

          <!-- Group 3: Diff Viewer -->
          <div class="settings-group">
            <div class="settings-group-title" data-i18n="settings.group_diff_viewer">Diff Viewer</div>

            <div class="setting-item"
              style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
              <label style="margin-bottom: 0;">
                <span style="color: var(--text-primary); font-size: 14px;" data-i18n="settings.diff_style">Diff
                  Style</span>
              </label>
              <select id="diffStyle" onchange="switchDiffStyle(this.value)" style="
                width: auto;
                min-width: 200px;
                padding: 10px 12px;
                padding-right: 32px;
                background-color: var(--bg-tertiary);
                background-image: url(&quot;data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e&quot;);
                background-repeat: no-repeat;
                background-position: right 8px center;
                background-size: 16px;
                border: 1px solid var(--border-subtle);
                border-radius: var(--radius-md);
                color: var(--text-primary);
                font-size: 14px;
                -webkit-appearance: none;
                appearance: none;
                text-align: left;
                cursor: pointer;
              ">
                <option value="style-2" data-i18n="settings.diff_style_high_contrast">High Contrast</option>
                <option value="style-1" data-i18n="settings.diff_style_github">GitHub Classic</option>
                <option value="style-3" data-i18n="settings.diff_style_gradient">Modern Gradient</option>
                <option value="style-4" data-i18n="settings.diff_style_terminal">Terminal</option>
                <option value="style-5" data-i18n="settings.diff_style_neon">Neon</option>
                <option value="style-6" data-i18n="settings.diff_style_pastel">Pastel</option>
                <option value="style-7" data-i18n="settings.diff_style_minimal">Minimal Border</option>
                <option value="style-8" data-i18n="settings.diff_style_split">Split Highlight</option>
              </select>
            </div>

            <div class="setting-item"
              style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
              <label style="margin-bottom: 0;">
                <span style="color: var(--text-primary); font-size: 14px;" data-i18n="settings.diff_view">Diff
                  View</span>
              </label>
              <div class="segmented-control">
                <input type="radio" name="diffViewFormat" id="diffViewUnified" value="unified"
                  onchange="toggleDiffViewFormat(false)">
                <label for="diffViewUnified" data-i18n="settings.diff_view_unified">Unified</label>
                <input type="radio" name="diffViewFormat" id="diffViewSplit" value="split" checked
                  onchange="toggleDiffViewFormat(true)">
                <label for="diffViewSplit" data-i18n="settings.diff_view_split">Side-by-Side</label>
                <div class="segmented-control-slider"></div>
              </div>
            </div>

            <div class="setting-item"
              style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
              <label style="margin-bottom: 0;">
                <span style="color: var(--text-primary); font-size: 14px;" data-i18n="settings.compare_against">Compare
                  Against</span>
              </label>
              <div class="segmented-control">
                <input type="radio" name="compareMode" id="compareModePrevious" value="previous"
                  onchange="setCompareMode('previous')">
                <label for="compareModePrevious" data-i18n="settings.compare_previous">Previous Version</label>
                <input type="radio" name="compareMode" id="compareModeCurrent" value="current" checked
                  onchange="setCompareMode('current')">
                <label for="compareModeCurrent" data-i18n="settings.compare_current">Current File</label>
                <div class="segmented-control-slider"></div>
              </div>
            </div>
          </div>

          <!-- Group: Cloud Backup -->
          <div class="settings-group">
            <div class="settings-group-title" data-i18n="settings.group_cloud_backup">Cloud Backup</div>

            <div class="setting-item" style="margin-bottom: 20px;">
              <label style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;">
                <span style="color: var(--text-primary); font-size: 14px;"
                  data-i18n="settings.cloud_sync_enabled">Enable Cloud Sync</span>
                <div class="toggle-switch">
                  <input type="checkbox" id="cloudSyncEnabled" style="display: none;"
                    onchange="handleCloudSyncToggle()">
                  <label for="cloudSyncEnabled" class="toggle-slider"></label>
                </div>
              </label>
            </div>

            <div id="cloudSyncOptions" style="display: none;">
              <!-- Cloud Provider Selector -->
              <div class="setting-item"
                style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                <label style="margin-bottom: 0;">
                  <span style="color: var(--text-primary); font-size: 14px;" data-i18n="settings.cloud_provider">Cloud
                    Provider</span>
                </label>
                <div class="segmented-control">
                  <input type="radio" name="cloudProvider" id="cloudProviderGithub" value="github" checked
                    onchange="handleCloudProviderChange()">
                  <label for="cloudProviderGithub">GitHub</label>
                  <input type="radio" name="cloudProvider" id="cloudProviderCustom" value="custom"
                    onchange="handleCloudProviderChange()">
                  <label for="cloudProviderCustom" data-i18n="settings.cloud_provider_custom">Custom</label>
                  <div class="segmented-control-slider"></div>
                </div>
              </div>

              <!-- Manual Remote URL (Custom Mode) -->
              <div id="customConfigSection" style="margin-bottom: 16px; display: none;">
                <!-- Not Connected State -->
                <div id="customNotConnected">
                  <label style="display: block; margin-bottom: 8px;">
                    <span style="color: var(--text-primary); font-size: 14px;"
                      data-i18n="settings.cloud_remote_url">Remote URL</span>
                  </label>
                  <input type="text" id="cloudRemoteUrl" placeholder="http://192.168.1.x:3000/user/repo.git" style="
                    width: 100%;
                    padding: 10px 12px;
                    background: var(--bg-tertiary);
                    border: 1px solid var(--border-subtle);
                    border-radius: var(--radius-md);
                    color: var(--text-primary);
                    font-size: 14px;
                    box-sizing: border-box;
                    margin-bottom: 8px;
                  ">
                  <button class="btn" onclick="testCustomConnection()"
                    style="width: 100%; background: var(--bg-tertiary); border: 1px solid var(--border-subtle); display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="4"></circle>
                      <line x1="1.05" y1="12" x2="7" y2="12"></line>
                      <line x1="17.01" y1="12" x2="22.96" y2="12"></line>
                    </svg>
                    <span>Test Connection</span>
                  </button>
                  <p style="color: var(--text-secondary); font-size: 12px; margin-top: 6px; margin-left: 2px;"
                    data-i18n="settings.cloud_remote_url_desc">
                    Supports HTTPS URLs (GitLab, Gitea, Bitbucket, etc.)
                  </p>
                </div>

                <!-- Connected State -->
                <div id="customConnected"
                  style="display: none; padding: 8px 12px; background: var(--bg-tertiary); border-radius: var(--radius-md);">
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                      stroke="var(--text-secondary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="4"></circle>
                      <line x1="1.05" y1="12" x2="7" y2="12"></line>
                      <line x1="17.01" y1="12" x2="22.96" y2="12"></line>
                    </svg>
                    <a id="customRepoLink" href="#" target="_blank"
                      style="color: var(--text-primary); font-size: 14px; font-weight: 500; text-decoration: none; flex: 1;"
                      onmouseover="this.style.color='var(--accent-blue)'; this.style.textDecoration='underline'"
                      onmouseout="this.style.color='var(--text-primary)'; this.style.textDecoration='none'">
                    </a>
                    <div style="color: var(--success); font-size: 12px; white-space: nowrap;">✓ Connected</div>
                    <button class="btn" onclick="disconnectCustom()"
                      style="background: var(--danger); padding: 2px 8px; font-size: 11px;">Disconnect</button>
                  </div>
                </div>
              </div>

              <!-- GitHub Configuration Section -->
              <div id="githubConfigSection">
                <!-- Repository Name -->
                <div id="repoNameSection" style="margin-bottom: 16px;">
                  <label style="display: block; margin-bottom: 8px;">
                    <span style="color: var(--text-primary); font-size: 14px;"
                      data-i18n="settings.cloud_repo_name">Repository Name</span>
                  </label>
                  <input type="text" id="cloudRepoName" value="VersionControlBackup" placeholder="VersionControlBackup"
                    style="
                    width: 100%;
                    padding: 10px 12px;
                    background: var(--bg-tertiary);
                    border: 1px solid var(--border-subtle);
                    border-radius: var(--radius-md);
                    color: var(--text-primary);
                    font-size: 14px;
                    box-sizing: border-box;
                  ">
                  <p id="cloudRepoNameDesc"
                    style="color: var(--text-secondary); font-size: 12px; margin-top: 6px; margin-left: 2px;"
                    data-i18n="settings.cloud_repo_name_desc">
                    A private repository will be created automatically
                  </p>
                </div>

                <!-- GitHub Connection -->
                <div style="margin-bottom: 16px;">
                  <label style="display: block; margin-bottom: 8px;">
                    <span style="color: var(--text-primary); font-size: 14px;"
                      data-i18n="settings.cloud_github_account">GitHub Account</span>
                  </label>

                  <!-- Not Connected State -->
                  <div id="githubNotConnected">
                    <button class="btn" onclick="connectGitHub()"
                      style="width: 100%; background: #24292e; display: flex; align-items: center; justify-content: center; gap: 8px;">
                      <svg height="20" width="20" viewBox="0 0 16 16" fill="white">
                        <path
                          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                      </svg>
                      <span data-i18n="settings.cloud_connect_github">Connect GitHub</span>
                    </button>
                  </div>

                  <!-- Connecting State (Device Flow) -->
                  <div id="githubConnecting" style="display: none;">
                    <div style="padding: 12px; background: var(--bg-tertiary); border-radius: var(--radius-md);">
                      <div style="color: var(--text-primary); font-size: 14px; margin-bottom: 8px;">Enter this code at
                        <a href="https://github.com/login/device" target="_blank"
                          style="color: var(--primary);">github.com/login/device</a>
                      </div>
                      <div id="githubUserCodeWrapper" onclick="copyGitHubCode()"
                        style="cursor: pointer; padding: 14px; background: rgb(32,32,32); border-radius: var(--radius-md); border: 1px solid var(--border-subtle); text-align: center; transition: filter 0.1s ease;"
                        onmouseover="this.style.filter='brightness(1.1)'" onmouseout="this.style.filter='brightness(1)'"
                        onmousedown="this.style.filter='brightness(0.9)'"
                        onmouseup="this.style.filter='brightness(1.1)'">
                        <div id="githubUserCode"
                          style="font-size: 24px; font-weight: 600; letter-spacing: 3px; color: var(--text-primary); font-family: monospace;">
                        </div>
                        <div style="color: var(--text-tertiary); font-size: 11px; margin-top: 6px;">
                          Tap to copy
                        </div>
                      </div>
                    </div>
                    <div
                      style="display: flex; align-items: center; justify-content: space-between; margin-top: 8px; padding: 0 2px;">
                      <span style="color: var(--text-secondary); font-size: 12px;"
                        data-i18n="settings.cloud_github_waiting">Waiting for authorization...</span>
                      <button onclick="cancelGitHubConnect()"
                        style="padding: 8px 16px; background: var(--bg-tertiary); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-size: 13px; cursor: pointer; transition: filter 0.15s ease;"
                        onmouseover="this.style.filter='brightness(1.2)'" onmouseout="this.style.filter='brightness(1)'"
                        data-i18n="app.cancel">Cancel</button>
                    </div>
                  </div>

                  <!-- Connected State -->
                  <div id="githubConnected"
                    style="display: none; padding: 8px 12px; background: var(--bg-tertiary); border-radius: var(--radius-md);">
                    <div style="display: flex; align-items: center; gap: 10px;">
                      <img id="githubAvatar" src="" alt="" style="width: 24px; height: 24px; border-radius: 50%;">
                      <a id="githubRepoLink" href="#" target="_blank"
                        style="color: var(--text-primary); font-size: 14px; font-weight: 500; text-decoration: none; flex: 1;"
                        onmouseover="this.style.color='var(--accent-blue)'; this.style.textDecoration='underline'"
                        onmouseout="this.style.color='var(--text-primary)'; this.style.textDecoration='none'">
                      </a>
                      <div style="color: var(--success); font-size: 12px; white-space: nowrap;">✓ Connected</div>
                      <button class="btn" onclick="disconnectGitHub()"
                        style="background: var(--danger); padding: 2px 8px; font-size: 11px;"
                        data-i18n="settings.cloud_disconnect">Disconnect</button>
                    </div>
                  </div>
                </div>
              </div>


              <div class="setting-item"
                style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                <label style="margin-bottom: 0;">
                  <span style="color: var(--text-primary); font-size: 14px;"
                    data-i18n="settings.cloud_push_frequency">Push Frequency</span>
                </label>
                <select id="cloudPushFrequency" style="
                  width: auto;
                  min-width: 180px;
                  padding: 10px 12px;
                  padding-right: 32px;
                  background-color: var(--bg-tertiary);
                  background-image: url(&quot;data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e&quot;);
                  background-repeat: no-repeat;
                  background-position: right 8px center;
                  background-size: 16px;
                  border: 1px solid var(--border-subtle);
                  border-radius: var(--radius-md);
                  color: var(--text-primary);
                  font-size: 14px;
                  -webkit-appearance: none;
                  appearance: none;
                  text-align: left;
                  cursor: pointer;
                ">
                  <option value="manual" data-i18n="settings.cloud_push_manual">Manual Only</option>
                  <option value="every_commit" data-i18n="settings.cloud_push_every_commit">After Every Commit</option>
                  <option value="hourly" data-i18n="settings.cloud_push_hourly">Hourly</option>
                  <option value="daily" data-i18n="settings.cloud_push_daily">Daily</option>
                </select>
              </div>

              <div class="setting-item" style="margin-bottom: 16px;">
                <label style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;">
                  <span style="color: var(--text-primary); font-size: 14px;"
                    data-i18n="settings.cloud_include_secrets">Include secrets.yaml</span>
                  <div class="toggle-switch">
                    <input type="checkbox" id="cloudIncludeSecrets" style="display: none;">
                    <label for="cloudIncludeSecrets" class="toggle-slider"></label>
                  </div>
                </label>
                <p style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; margin-left: 2px;"
                  data-i18n="settings.cloud_include_secrets_desc">
                  This will upload your secrets.yaml to the cloud
                </p>
              </div>

              <!-- Push to Cloud - styled as inline setting item -->
              <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <span style="color: var(--text-primary); font-size: 14px;">Push to Cloud</span>
                  <p id="cloudSyncStatus"
                    style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; margin-bottom: 0;">
                    <span data-i18n="settings.cloud_last_push">Last push:</span>
                    <span id="cloudLastPushTime">Never</span>
                    <span id="cloudLastPushStatus"></span>
                  </p>
                </div>
                <button onclick="pushToCloudNow()"
                  style="padding: 8px 16px; background: var(--bg-tertiary); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-size: 13px; cursor: pointer; transition: filter 0.15s ease; white-space: nowrap;"
                  onmouseover="this.style.filter='brightness(1.2)'" onmouseout="this.style.filter='brightness(1)'"
                  data-i18n="settings.cloud_push_now">
                  Push Now
                </button>
              </div>
            </div>
          </div>

          <!-- Group 3: Appearance -->
          <div class="settings-group">
            <div class="settings-group-title" data-i18n="settings.group_appearance">Appearance</div>

            <div class="setting-item"
              style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
              <label style="margin-bottom: 0;">
                <span style="color: var(--text-primary); font-size: 14px;" data-i18n="settings.theme">Theme</span>
              </label>
              <div class="segmented-control">
                <input type="radio" name="themeMode" id="themeLight" value="light" onchange="setTheme('light')">
                <label for="themeLight" title="Light Mode">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                  </svg>
                </label>
                <input type="radio" name="themeMode" id="themeDark" value="dark" checked onchange="setTheme('dark')">
                <label for="themeDark" title="Dark Mode">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                  </svg>
                </label>
                <div class="segmented-control-slider"></div>
              </div>
            </div>

            <div class="setting-item" style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 12px;">
                <span style="color: var(--text-primary); font-size: 14px;" data-i18n="settings.color_scheme">Color
                  Scheme</span>
              </label>
              <div class="color-palette-container" id="combinedPaletteContainer">
                <!-- Colors will be injected by JS -->
              </div>
              <!-- Hidden inputs for logic -->
              <div style="display: none;">
                <input type="color" id="picassoPrimaryColor" value="#10b981">
                <input type="color" id="picassoSecondaryColor" value="#3b82f6">
              </div>
            </div>
          </div>

          <!-- Holiday Mode at the very bottom -->
          <div class="settings-group" style="display: none;">
            <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <span style="color: var(--text-primary); font-size: 14px;" data-i18n="settings.holiday_mode">Holiday
                  Mode</span>
              </div>
              <div class="toggle-switch">
                <input type="checkbox" id="holidayMode" style="display: none;">
                <label for="holidayMode" class="toggle-slider" onclick="toggleHolidayMode()"></label>
              </div>
            </div>
          </div>
        </div>
      </div>


      <div class="modal-footer">
        <button class="btn" onclick="closeSettings()" data-i18n="app.close">Close</button>
        <button class="btn" onclick="saveSettings()" style="background: var(--success);"
          data-i18n="app.save_settings">Save Settings</button>
      </div>
    </div>
  </div>


  <script src="app.js?v=1734394700"></script>
</body>

</html>